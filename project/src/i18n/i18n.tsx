import React, { createContext, useContext, useEffect, useMemo, useState } from 'react';

export type Language = 'en' | 'hi' | 'mr';

type DictValue = string | ((vars?: Record<string, string | number>) => string);
type Dictionary = Record<string, DictValue>;

type I18nContextValue = {
  lang: Language;
  setLang: (lang: Language) => void;
  t: (key: string, vars?: Record<string, string | number>) => string;
};

const I18nContext = createContext<I18nContextValue | null>(null);

const STORAGE_KEY = 'kms_lang';

function interpolate(template: string, vars?: Record<string, string | number>) {
  if (!vars) return template;
  return template.replace(/\{(\w+)\}/g, (_, k: string) => (vars[k] ?? `{${k}}`).toString());
}

const DICT: Record<Language, Dictionary> = {
  en: {
    // App header/home
    'app.title': 'Nashik Kumbh Mela – Medical Seva',
    'app.subtitle': 'Godavari Ghat emergency care & digital medical records',
    'home.kumbhYear': 'Nashik Kumbh Mela 2026',
    'home.heroTitle': "Seva for every Yatri's health",
    'home.heroDesc':
      'Register yatris, access medical history, and respond quickly to incidents along the Godavari ghats and Kumbh routes.',
    'home.cta.register.title': 'New Yatri Registration',
    'home.cta.register.desc': 'Enroll yatris with verified personal and medical details',
    'home.cta.search.title': 'Emergency Record Search',
    'home.cta.search.desc': 'Quickly find yatri medical records during critical incidents',
    'home.designedFor.title': 'Designed for Kumbh Mela ground teams',
    'home.designedFor.1': 'Capture complete yatri profile with medical history and allergies',
    'home.designedFor.2': 'Instant search by name, phone, or Kumbh registration number',
    'home.designedFor.3': 'Emergency contact and location details for fast coordination',
    'home.designedFor.4': 'Structured medical incident logging at ghats, camps, and transit points',
    'home.designedFor.5': 'Comprehensive history to support triage and referrals',

    // Navigation / generic
    'nav.backHome': 'Back to Home',
    'nav.home': 'Home',
    'nav.register': 'Register',
    'nav.search': 'Search',
    'nav.analytics': 'Analytics',
    'nav.lostFound': 'Lost & Found',
    'nav.ariaMain': 'Main navigation',
    'lang.label': 'Language',
    'lang.en': 'EN',
    'lang.hi': 'हिंदी',
    'lang.mr': 'मराठी',
    'lang.current': ({ code }: any) => `Using ${code}`,

    // Registration success
    'register.pageTitle': 'New Yatri Registration',
    'register.pageDesc': 'Record yatri details and medical history for Nashik Kumbh Mela',
    'register.successTitle': 'Registration Successful!',
    'register.kumbhId': 'Kumbh Reg ID:',
    'register.redirecting': 'Redirecting to home in a moment...',

    // Registration form
    'reg.personalInfo': 'Personal Information',
    'reg.fullName': 'Full Name *',
    'reg.age': 'Age *',
    'reg.gender': 'Gender *',
    'reg.gender.male': 'Male',
    'reg.gender.female': 'Female',
    'reg.gender.other': 'Other',
    'reg.phone': 'Phone Number *',

    'reg.emergencyName': 'Emergency Contact Name *',
    'reg.emergencyPhone': 'Emergency Contact Phone *',
    'reg.selfie': 'Selfie Photo *',
    'reg.takeSelfie': 'Take Selfie',
    'reg.selfieHint': 'Please ensure you are alone and keep your mouth closed while taking the photo.',
    'reg.medicalInfo': 'Medical Information',
    'reg.bloodGroup': 'Blood Group',
    'reg.selectBloodGroup': 'Select Blood Group',
    'reg.height': 'Height (cm)',
    'reg.weight': 'Weight (kg)',

    'reg.allergies': 'Known Allergies',
    'reg.allergiesPlaceholder': 'Food allergies, drug allergies, etc.',
    'reg.chronic': 'Chronic Conditions',
    'reg.chronicPlaceholder': 'Select...',
    'condition.diabetes': 'Diabetes',
    'condition.hypertension': 'Hypertension',
    'condition.asthma': 'Asthma',
    'condition.arthritis': 'Arthritis',
    'condition.none': 'None',
    'condition.other': 'Other (Specify)',
    'reg.meds': 'Current Medications',
    'reg.medsPlaceholder': 'List all current medications and dosages',
    'reg.surgeries': 'Past Surgeries',
    'reg.surgeriesPlaceholder': 'List any previous surgeries',
    'reg.notes': 'Special Medical Notes',
    'reg.notesPlaceholder': 'Any other important medical information',
    'reg.submitting': 'Registering...',
    'reg.submit': 'Register Devotee',
    'reg.fail': ({ message }: any) => `Registration failed: ${message}`,
    'reg.reviewTitle': 'Review Your Information',
    'reg.reviewDesc': 'Please review all information before submitting',
    'reg.editInfo': 'Go Back & Edit',
    'reg.confirmSubmit': 'Submit Registration',
    'reg.reviewSubmit': 'Continue to Review',

    // Medical Recommendations
    'medical.dos': 'Recommended Actions (Dos)',
    'medical.donts': 'Things to Avoid (Don\'ts)',
    'medical.emergency': 'Emergency Warning Signs',
    'medical.disclaimer': 'Medical Disclaimer:',
    'medical.disclaimerText': 'These recommendations are general guidelines based on your reported conditions. Always consult your healthcare provider for personalized medical advice. In case of emergency, call your local emergency services immediately.',

    // Search
    'search.pageTitle': 'Search Yatri Medical Records',
    'search.pageDesc': 'Find pilgrim information quickly during a medical emergency',
    'search.type.name': 'Name',
    'search.type.phone': 'Phone',
    'search.type.registration': 'Registration No.',
    'search.placeholder': ({ type }: any) => `Search by ${type}...`,
    'search.searching': 'Searching...',
    'search.search': 'Search',
    'search.byFace': 'Search by Face (Selfie)',
    'search.orSeparator': 'Or search by details',
    'search.noneFound': 'No devotees found matching your search.',
    'search.found': ({ count }: any) => `Found ${count} result${count !== 1 ? 's' : ''}`,
    'search.age': 'Age:',
    'search.gender': 'Gender:',
    'search.phone': 'Phone:',
    'search.blood': 'Blood:',

    'search.match': ({ pct }: any) => `Match: ${pct}%`,
    'search.fail': ({ message }: any) => `Search failed: ${message}`,
    'search.face.noDescriptor':
      'Could not read face from the photo. Please try again with clear lighting and face visible.',
    'search.face.fail': ({ message }: any) => `Face search failed: ${message}`,
    'search.filter.gender': 'Filter by gender',
    'search.filter.gender.all': 'All',
    'search.filter.gender.male': 'Male',
    'search.filter.gender.female': 'Female',
    'search.filter.gender.other': 'Other',
    'search.filter.minAge': 'Min age',
    'search.filter.maxAge': 'Max age',
    'search.filter.noneAfterFilter': 'No results match the current filters. Try widening your filters.',
    'search.quickIncident': 'Record incident for this yatri',
    'search.chronic': 'Chronic conditions:',

    // Profile
    'profile.registration': 'Registration:',
    'profile.emergencyContact': 'Emergency Contact',
    'profile.name': 'Name:',
    'profile.personalDetails': 'Personal Details',
    'profile.ageYears': ({ years }: any) => `${years} years`,
    'profile.gender': 'Gender:',
    'profile.phone': 'Phone:',

    'profile.vitalInfo': 'Vital Information',
    'profile.bloodGroup': 'Blood Group:',
    'profile.height': 'Height:',
    'profile.weight': 'Weight:',
    'profile.notSpecified': 'Not specified',

    'profile.medicalHistory': 'Medical History',
    'profile.allergies': 'Allergies:',
    'profile.noneReported': 'None reported',
    'profile.chronic': 'Chronic Conditions:',
    'profile.none': 'None',
    'profile.meds': 'Current Medications:',
    'profile.surgeries': 'Past Surgeries:',
    'profile.specialNotes': 'Special Notes:',
    'profile.incidentsHistory': 'Medical Incidents History',
    'profile.recordIncident': 'Record New Incident',
    'profile.loadingIncidents': 'Loading incidents...',
    'profile.noIncidents': 'No medical incidents recorded.',
    'profile.followUpRequired': 'Follow-up Required',
    'profile.symptoms': 'Symptoms:',
    'profile.diagnosis': 'Diagnosis:',
    'profile.treatment': 'Treatment:',
    'profile.medications': 'Medications:',
    'profile.doctor': 'Doctor:',
    'profile.center': 'Center:',
    'profile.followUpNotes': 'Follow-up Notes:',

    // Incident form
    'incident.title': 'Record Medical Incident',
    'incident.for': 'For:',
    'incident.type': 'Incident Type *',
    'incident.type.emergency': 'Emergency',
    'incident.type.consultation': 'Consultation',
    'incident.type.followup': 'Follow-up',
    'incident.doctor': 'Attending Doctor *',
    'incident.doctorPlaceholder': 'Dr. Name',
    'incident.center': 'Medical Center *',
    'incident.centerPlaceholder': 'Center/Hospital Name',
    'incident.symptoms': 'Symptoms *',
    'incident.symptomsPlaceholder': 'Describe the symptoms presented...',
    'incident.diagnosis': 'Diagnosis',
    'incident.diagnosisPlaceholder': 'Medical diagnosis...',
    'incident.treatment': 'Treatment Given',
    'incident.treatmentPlaceholder': 'Treatment provided...',
    'incident.meds': 'Medications Prescribed',
    'incident.medsPlaceholder': 'List medications and dosages...',
    'incident.followUpRequired': 'Follow-up Required',
    'incident.followUpHelp': 'Check if patient needs follow-up care',
    'incident.followUpNotes': 'Follow-up Notes',
    'incident.followUpNotesPlaceholder': 'Instructions for follow-up care...',
    'incident.cancel': 'Cancel',
    'incident.saving': 'Saving...',
    'incident.submit': 'Record Incident',
    'incident.fail': ({ message }: any) => `Failed to record incident: ${message}`,

    // Lost & Found
    'lost.title': 'AI Lost & Found',
    'lost.subtitle': 'Reuniting families with Facial Recognition',
    'lost.backHome': 'Back to Home',
    'lost.reportMissing': 'Report Missing Person',
    'lost.reportMissingDesc': 'Upload photo & details of lost family member',
    'lost.foundSomeone': 'I Found Someone',
    'lost.foundSomeoneDesc': 'Scan face to check if they are reported missing',
    'lost.recent': 'Recently Reported Missing',
    'lost.noActive': 'No active reports.',
    'lost.badge.missing': 'MISSING',
    'lost.reportDetails': 'Report Details',
    'lost.form.name': 'Full Name',
    'lost.form.age': 'Age (Approx)',
    'lost.form.gender': 'Gender',
    'lost.form.contact': 'Your Contact Name/Phone',
    'lost.form.contactPlaceholder': 'e.g. Rahul - 9876543210',
    'lost.submit': 'Submit Report',
    'lost.submitting': 'Submitting...',
    'lost.match.title': 'Match Results',
    'lost.match.none': 'No Match Found',
    'lost.match.noneDesc': 'This person has not been reported missing yet.',
    'lost.match.reportAsFound': 'Report as Found Person instead',
    'lost.match.foundCount': ({ count }: any) => `Found ${count} possible matches!`,
    'lost.match.matchPct': ({ pct }: any) => `${pct}% Match`,
    'lost.match.reportedBy': 'Reported by:',
    'lost.match.missingSince': 'Missing since:',
    'lost.match.call': 'Call Reporter',

    // Analytics Alerts
    'analytics.alert.title': 'Government Medical Alert!',
    'analytics.alert.desc': ({ condition, count }: any) => `High risk cluster detected: ${count} cases of ${condition}. Immediate attention required.`,

    // Analytics
    'analytics.title': 'Health Analytics Dashboard',
    'analytics.desc': 'Real-time insights on pilgrim health and crowd demographics',
    'analytics.totalYatris': 'Total Pilgrims',
    'analytics.highRisk': 'High Risk (Medical)',
    'analytics.seniorCitizens': 'Senior Citizens (60+)',
    'analytics.recentActivity': 'Recent Registrations',
    'analytics.ageDist': 'Age Distribution',
    'analytics.genderDist': 'Gender Ratio',
    'analytics.conditions': 'Prevalent Medical Conditions',

    // Common
    'common.close': 'Close',
    'common.add': 'Add',
    'common.voiceNotSupported': 'Voice input is not supported in this browser.',
    'common.voiceMicDenied': 'Microphone access denied. Please allow microphone permissions in your browser settings.',
    'common.voiceNoMic': 'No microphone was found. Please ensure a microphone is connected.',
    'common.voiceNetworkError': 'Network error occurred. Please check your internet connection and try again.',
    'common.total': 'total',
    'common.copied': 'Copied!',
    'common.copy': 'Copy',
    'common.startVoice': 'Start voice input',
    'common.stopVoice': 'Stop listening',
    'common.listening': 'Listening...',

    // Selfie capture
    'selfie.loadingModels': 'Loading face detection models...',
    'selfie.failModels':
      'Failed to load face detection models. Please check your internet connection and refresh the page.',
    'selfie.failCamera': 'Unable to access camera. Please ensure camera permissions are granted.',
    'selfie.failCameraShort': 'Unable to access camera.',
    'selfie.title': 'Take Selfie',
    'selfie.retake': 'Retake',
    'selfie.usePhoto': 'Use This Photo',
    'selfie.cancel': 'Cancel',
    'selfie.capturing': 'Capturing...',
    'selfie.capture': 'Capture Photo',
    'selfie.tip.1': 'Ensure you are alone in the frame',
    'selfie.tip.2': 'Keep your mouth closed (not talking)',
    'selfie.tip.3': 'Look directly at the camera',
    'selfie.tip.4': 'Ensure good lighting',
    'selfie.noFace': 'No face detected. Please position yourself in front of the camera.',
    'selfie.multiFace': 'Multiple faces detected. Please ensure you are alone in the frame.',
    'selfie.landmarksOk': 'Face detected. Landmarks unavailable, you may capture.',
    'selfie.ready': '✓ Face detected. Ready to capture!',
    'selfie.bodyTip': 'For accurate height/weight detection',
    'selfie.bodyInstructions': 'Step back to show your full body from head to toe',
    'selfie.bodyDetected': 'Body detected! Ready to capture',
    'selfie.bodyNotVisible': 'Please show more of your body',
    'selfie.mouthOpen': 'Please keep your mouth closed (not talking).',
  },
  hi: {
    'app.title': 'नाशिक कुंभ मेला – मेडिकल सेवा',
    'app.subtitle': 'गोदावरी घाट आपातकालीन देखभाल और डिजिटल मेडिकल रिकॉर्ड',
    'home.kumbhYear': 'नाशिक कुंभ मेला 2026',
    'home.heroTitle': 'हर यात्री के स्वास्थ्य के लिए सेवा',
    'home.heroDesc':
      'यात्रियों का रजिस्ट्रेशन करें, मेडिकल इतिहास देखें, और गोदावरी घाट व कुंभ मार्गों पर घटनाओं में जल्दी मदद करें।',
    'home.cta.register.title': 'नया यात्री रजिस्ट्रेशन',
    'home.cta.register.desc': 'सत्यापित व्यक्तिगत और मेडिकल जानकारी के साथ पंजीकरण करें',
    'home.cta.search.title': 'आपातकालीन रिकॉर्ड खोज',
    'home.cta.search.desc': 'आपात स्थिति में यात्री के मेडिकल रिकॉर्ड तुरंत खोजें',
    'home.designedFor.title': 'कुंभ मेला ग्राउंड टीम के लिए',
    'home.designedFor.1': 'मेडिकल इतिहास और एलर्जी सहित पूरा प्रोफाइल दर्ज करें',
    'home.designedFor.2': 'नाम, फोन, या कुंभ रजिस्ट्रेशन नंबर से तुरंत खोज',
    'home.designedFor.3': 'तेज़ समन्वय के लिए इमरजेंसी कॉन्टैक्ट और लोकेशन',
    'home.designedFor.4': 'घाट/कैंप/यात्रा बिंदुओं पर घटना लॉगिंग',
    'home.designedFor.5': 'ट्राइएज और रेफरल के लिए पूरा इतिहास',

    'nav.backHome': 'होम पर वापस',
    'nav.home': 'होम',
    'nav.register': 'रजिस्ट्रेशन',
    'nav.search': 'खोज',
    'nav.analytics': 'एनालिटिक्स',
    'nav.lostFound': 'खोया-पाया',
    'nav.ariaMain': 'मुख्य नेविगेशन',
    'lang.label': 'भाषा',
    'lang.en': 'EN',
    'lang.hi': 'हिंदी',
    'lang.mr': 'मराठी',
    'lang.current': ({ code }: any) => `चयनित: ${code}`,

    'register.pageTitle': 'नया यात्री रजिस्ट्रेशन',
    'register.pageDesc': 'नाशिक कुंभ मेला के लिए यात्री की जानकारी और मेडिकल इतिहास दर्ज करें',
    'register.successTitle': 'रजिस्ट्रेशन सफल!',
    'register.kumbhId': 'कुंभ रजिस्ट्रेशन ID:',
    'register.redirecting': 'थोड़ी देर में होम पर जा रहे हैं...',

    'reg.personalInfo': 'व्यक्तिगत जानकारी',
    'reg.fullName': 'पूरा नाम *',
    'reg.age': 'उम्र *',
    'reg.gender': 'लिंग *',
    'reg.gender.male': 'पुरुष',
    'reg.gender.female': 'महिला',
    'reg.gender.other': 'अन्य',
    'reg.phone': 'फोन नंबर *',

    'reg.emergencyName': 'इमरजेंसी कॉन्टैक्ट नाम *',
    'reg.emergencyPhone': 'इमरजेंसी कॉन्टैक्ट फोन *',
    'reg.selfie': 'सेल्फी फोटो *',
    'reg.takeSelfie': 'सेल्फी लें',
    'reg.selfieHint': 'कृपया अकेले रहें और फोटो लेते समय मुंह बंद रखें।',
    'reg.medicalInfo': 'मेडिकल जानकारी',
    'reg.bloodGroup': 'ब्लड ग्रुप',
    'reg.selectBloodGroup': 'ब्लड ग्रुप चुनें',
    'reg.height': 'ऊंचाई (cm)',
    'reg.weight': 'वज़न (kg)',

    'reg.allergies': 'एलर्जी',
    'reg.allergiesPlaceholder': 'खाने/दवाओं की एलर्जी आदि',
    'reg.chronic': 'पुरानी बीमारियाँ',
    'reg.chronicPlaceholder': 'चुनें...',
    'condition.diabetes': 'मधुमेह (Diabetes)',
    'condition.hypertension': 'उच्च रक्तचाप (BP)',
    'condition.asthma': 'दमा (Asthma)',
    'condition.arthritis': 'गठिया (Arthritis)',
    'condition.none': 'कोई नहीं',
    'condition.other': 'अन्य (बताएं)',
    'reg.meds': 'वर्तमान दवाएँ',
    'reg.medsPlaceholder': 'दवाओं के नाम और मात्रा लिखें',
    'reg.surgeries': 'पिछली सर्जरी',
    'reg.surgeriesPlaceholder': 'पहले हुई सर्जरी लिखें',
    'reg.notes': 'विशेष मेडिकल नोट्स',
    'reg.notesPlaceholder': 'अन्य महत्वपूर्ण मेडिकल जानकारी',
    'reg.submitting': 'रजिस्टर हो रहा है...',
    'reg.submit': 'यात्री रजिस्टर करें',
    'reg.fail': ({ message }: any) => `रजिस्ट्रेशन असफल: ${message}`,
    'reg.reviewTitle': 'अपनी जानकारी की समीक्षा करें',
    'reg.reviewDesc': 'कृपया सबमिट करने से पहले सभी जानकारी की समीक्षा करें',
    'reg.editInfo': 'वापस जाएं और संपादित करें',
    'reg.confirmSubmit': 'रजिस्ट्रेशन सबमिट करें',
    'reg.reviewSubmit': 'समीक्षा के लिए जारी रखें',

    // Medical Recommendations
    'medical.dos': 'सुझाई गई कार्रवाइयां (करें)',
    'medical.donts': 'बचने योग्य बातें (न करें)',
    'medical.emergency': 'आपातकालीन चेतावनी संकेत',
    'medical.disclaimer': 'चिकित्सा अस्वीकरण:',
    'medical.disclaimerText': 'ये सिफारिशें आपकी रिपोर्ट की गई स्थितियों के आधार पर सामान्य दिशानिर्देश हैं। व्यक्तिगत चिकित्सा सलाह के लिए हमेशा अपने स्वास्थ्य सेवा प्रदाता से परामर्श करें। आपात स्थिति में तुरंत अपनी स्थानीय आपातकालीन सेवाओं को कॉल करें।',

    'search.pageTitle': 'यात्री मेडिकल रिकॉर्ड खोजें',
    'search.pageDesc': 'आपातकाल में यात्री की जानकारी जल्दी खोजें',
    'search.type.name': 'नाम',
    'search.type.phone': 'फोन',
    'search.type.registration': 'रजिस्ट्रेशन नं.',
    'search.placeholder': ({ type }: any) => `${type} से खोजें...`,
    'search.searching': 'खोज रहे हैं...',
    'search.search': 'खोजें',
    'search.byFace': 'चेहरे से खोजें (सेल्फी)',
    'search.orSeparator': 'या विवरण से खोजें',
    'search.noneFound': 'आपकी खोज से कोई परिणाम नहीं मिला।',
    'search.found': ({ count }: any) => `${count} परिणाम मिले`,
    'search.age': 'उम्र:',
    'search.gender': 'लिंग:',
    'search.phone': 'फोन:',
    'search.blood': 'ब्लड:',

    'search.match': ({ pct }: any) => `मैच: ${pct}%`,
    'search.fail': ({ message }: any) => `खोज असफल: ${message}`,
    'search.face.noDescriptor': 'फोटो से चेहरा नहीं पढ़ पाया। कृपया अच्छी रोशनी में फिर कोशिश करें।',
    'search.face.fail': ({ message }: any) => `चेहरा खोज असफल: ${message}`,
    'search.filter.gender': 'लिंग से फिल्टर',
    'search.filter.gender.all': 'सभी',
    'search.filter.gender.male': 'पुरुष',
    'search.filter.gender.female': 'महिला',
    'search.filter.gender.other': 'अन्य',
    'search.filter.minAge': 'न्यूनतम उम्र',
    'search.filter.maxAge': 'अधिकतम उम्र',
    'search.filter.noneAfterFilter': 'फिल्टर लगाने के बाद कोई परिणाम नहीं बचा। कृपया फिल्टर बदलें।',
    'search.quickIncident': 'इस यात्री के लिए घटना दर्ज करें',
    'search.chronic': 'पुरानी बीमारियाँ:',

    'profile.registration': 'रजिस्ट्रेशन:',
    'profile.emergencyContact': 'इमरजेंसी कॉन्टैक्ट',
    'profile.name': 'नाम:',
    'profile.personalDetails': 'व्यक्तिगत विवरण',
    'profile.ageYears': ({ years }: any) => `${years} वर्ष`,
    'profile.gender': 'लिंग:',
    'profile.phone': 'फोन:',

    'profile.vitalInfo': 'महत्वपूर्ण जानकारी',
    'profile.bloodGroup': 'ब्लड ग्रुप:',
    'profile.height': 'ऊंचाई:',
    'profile.weight': 'वज़न:',
    'profile.notSpecified': 'उल्लेख नहीं',

    'profile.medicalHistory': 'मेडिकल इतिहास',
    'profile.allergies': 'एलर्जी:',
    'profile.noneReported': 'कोई नहीं',
    'profile.chronic': 'पुरानी बीमारियाँ:',
    'profile.none': 'कोई नहीं',
    'profile.meds': 'वर्तमान दवाएँ:',
    'profile.surgeries': 'पिछली सर्जरी:',
    'profile.specialNotes': 'विशेष नोट्स:',
    'profile.incidentsHistory': 'मेडिकल घटनाओं का इतिहास',
    'profile.recordIncident': 'नई घटना दर्ज करें',
    'profile.loadingIncidents': 'घटनाएँ लोड हो रही हैं...',
    'profile.noIncidents': 'कोई मेडिकल घटना दर्ज नहीं है।',
    'profile.followUpRequired': 'फॉलो-अप आवश्यक',
    'profile.symptoms': 'लक्षण:',
    'profile.diagnosis': 'निदान:',
    'profile.treatment': 'उपचार:',
    'profile.medications': 'दवाएँ:',
    'profile.doctor': 'डॉक्टर:',
    'profile.center': 'केंद्र:',
    'profile.followUpNotes': 'फॉलो-अप नोट्स:',

    'incident.title': 'मेडिकल घटना दर्ज करें',
    'incident.for': 'के लिए:',
    'incident.type': 'घटना प्रकार *',
    'incident.type.emergency': 'आपातकाल',
    'incident.type.consultation': 'परामर्श',
    'incident.type.followup': 'फॉलो-अप',
    'incident.doctor': 'ड्यूटी डॉक्टर *',
    'incident.doctorPlaceholder': 'डॉ. का नाम',
    'incident.center': 'मेडिकल सेंटर *',
    'incident.centerPlaceholder': 'केंद्र/अस्पताल नाम',
    'incident.symptoms': 'लक्षण *',
    'incident.symptomsPlaceholder': 'लक्षण लिखें...',
    'incident.diagnosis': 'निदान',
    'incident.diagnosisPlaceholder': 'निदान लिखें...',
    'incident.treatment': 'दिया गया उपचार',
    'incident.treatmentPlaceholder': 'उपचार लिखें...',
    'incident.meds': 'लिखी गई दवाएँ',
    'incident.medsPlaceholder': 'दवाओं के नाम/मात्रा लिखें...',
    'incident.followUpRequired': 'फॉलो-अप आवश्यक',
    'incident.followUpHelp': 'यदि मरीज को फॉलो-अप चाहिए तो चुनें',
    'incident.followUpNotes': 'फॉलो-अप नोट्स',
    'incident.followUpNotesPlaceholder': 'फॉलो-अप निर्देश...',
    'incident.cancel': 'रद्द करें',
    'incident.saving': 'सेव हो रहा है...',
    'incident.submit': 'घटना दर्ज करें',
    'incident.fail': ({ message }: any) => `घटना दर्ज नहीं हुई: ${message}`,

    // Lost & Found - Hindi
    'lost.title': 'AI खोया-पाया (Lost & Found)',
    'lost.subtitle': 'चेहरे की पहचान से परिवारों को मिलाना',
    'lost.backHome': 'होम पर वापस',
    'lost.reportMissing': 'लापता व्यक्ति की रिपोर्ट करें',
    'lost.reportMissingDesc': 'लापता परिजन की फोटो और जानकारी अपलोड करें',
    'lost.foundSomeone': 'मुझे कोई मिला है',
    'lost.foundSomeoneDesc': 'चेहरा स्कैन करें और देखें कि क्या वे लापता हैं',
    'lost.recent': 'हाल ही में लापता रिपोर्ट',
    'lost.noActive': 'कोई सक्रिय रिपोर्ट नहीं।',
    'lost.badge.missing': 'लापता',
    'lost.reportDetails': 'रिपोर्ट विवरण',
    'lost.form.name': 'पूरा नाम',
    'lost.form.age': 'उम्र (लगभग)',
    'lost.form.gender': 'लिंग',
    'lost.form.contact': 'आपका संपर्क नाम/फोन',
    'lost.form.contactPlaceholder': 'उदा. राहुल - 9876543210',
    'lost.submit': 'रिपोर्ट जमा करें',
    'lost.submitting': 'जमा हो रहा है...',
    'lost.match.title': 'मैच परिणाम',
    'lost.match.none': 'कोई मैच नहीं मिला',
    'lost.match.noneDesc': 'इस व्यक्ति की गुमशुदगी की रिपोर्ट अभी तक नहीं मिली है।',
    'lost.match.reportAsFound': 'इसके बजाय "पाया गया" रिपोर्ट करें',
    'lost.match.foundCount': ({ count }: any) => `${count} संभावित मैच मिले!`,
    'lost.match.matchPct': ({ pct }: any) => `${pct}% मैच`,
    'lost.match.reportedBy': 'रिपोर्टकर्ता:',
    'lost.match.missingSince': 'कब से लापता:',
    'lost.match.call': 'रिपोर्टकर्ता को कॉल करें',

    // Analytics Alerts
    'analytics.alert.title': 'सरकारी मेडिकल अलर्ट!',
    'analytics.alert.desc': ({ condition, count }: any) => `उच्च जोखिम समूह: ${condition} के ${count} मामले। तुरंत ध्यान दें।`,

    // Analytics
    'analytics.title': 'स्वास्थ्य एनालिटिक्स डैशबोर्ड',
    'analytics.desc': 'तीर्थयात्री स्वास्थ्य और भीड़ जनसांख्यिकी पर रीयल-टाइम अंतर्दृष्टि',
    'analytics.totalYatris': 'कुल तीर्थयात्री',
    'analytics.highRisk': 'उच्च जोखिम (मेडिकल)',
    'analytics.seniorCitizens': 'वरिष्ठ नागरिक (60+)',
    'analytics.recentActivity': 'हालिया पंजीकरण',
    'analytics.ageDist': 'आयु वितरण',
    'analytics.genderDist': 'लिंग अनुपात',
    'analytics.conditions': 'प्रमुख चिकित्सा स्थितियां',

    'common.close': 'बंद करें',
    'common.add': 'जोड़ें',
    'common.voiceNotSupported': 'इस ब्राउज़र में वॉयस इनपुट समर्थित नहीं है।',
    'common.voiceMicDenied': 'माइक्रोफोन अनुमति अस्वीकृत। कृपया अपने ब्राउज़र सेटिंग्स में माइक्रोफोन अनुमति दें।',
    'common.voiceNoMic': 'कोई माइक्रोफोन नहीं मिला। कृपया सुनिश्चित करें कि माइक्रोफोन कनेक्ट है।',
    'common.voiceNetworkError': 'नेटवर्क त्रुटि हुई। कृपया अपना इंटरनेट कनेक्शन जांचें और पुनः प्रयास करें।',
    'common.total': 'कुल',
    'common.copied': 'कॉपी हो गया!',
    'common.copy': 'कॉपी',
    'common.startVoice': 'वॉयस इनपुट शुरू करें',
    'common.stopVoice': 'सुनना बंद करें',
    'common.listening': 'सुन रहा है...',

    'selfie.loadingModels': 'फेस मॉडल लोड हो रहे हैं...',
    'selfie.failModels': 'फेस मॉडल लोड नहीं हो पाए। इंटरनेट जांचें और पेज रिफ्रेश करें।',
    'selfie.failCamera': 'कैमरा नहीं खुल पाया। कृपया कैमरा अनुमति दें।',
    'selfie.failCameraShort': 'कैमरा नहीं खुल पाया।',
    'selfie.title': 'सेल्फी लें',
    'selfie.retake': 'फिर से लें',
    'selfie.usePhoto': 'यह फोटो उपयोग करें',
    'selfie.cancel': 'रद्द करें',
    'selfie.capturing': 'कैप्चर हो रहा है...',
    'selfie.capture': 'फोटो लें',
    'selfie.tip.1': 'फ्रेम में अकेले रहें',
    'selfie.tip.2': 'मुंह बंद रखें',
    'selfie.tip.3': 'कैमरे की तरफ देखें',
    'selfie.tip.4': 'अच्छी रोशनी रखें',
    'selfie.noFace': 'चेहरा नहीं मिला। कृपया कैमरे के सामने आएँ।',
    'selfie.multiFace': 'एक से ज्यादा चेहरे मिले। कृपया अकेले रहें।',
    'selfie.landmarksOk': 'चेहरा मिला। आप फोटो ले सकते हैं।',
    'selfie.ready': '✓ चेहरा मिला। फोटो लें!',
    'selfie.bodyTip': 'सटीक ऊंचाई/वजन का पता लगाने के लिए',
    'selfie.bodyInstructions': 'अपने पूरे शरीर को सिर से पैर तक दिखाने के लिए पीछे हटें',
    'selfie.bodyDetected': 'शरीर पहचान लिया गया! फोटो लेने के लिए तैयार',
    'selfie.bodyNotVisible': 'कृपया अपने शरीर का अधिक भाग दिखाएं',
    'selfie.mouthOpen': 'कृपया मुंह बंद रखें।',
  },
  mr: {
    'app.title': 'नाशिक कुंभ मेळा – मेडिकल सेवा',
    'app.subtitle': 'गोदावरी घाट आपत्कालीन उपचार व डिजिटल वैद्यकीय नोंदी',
    'home.kumbhYear': 'नाशिक कुंभ मेळा 2026',
    'home.heroTitle': 'प्रत्येक यात्रेकरूच्या आरोग्यासाठी सेवा',
    'home.heroDesc':
      'यात्री नोंदणी करा, वैद्यकीय इतिहास पाहा, आणि गोदावरी घाट व कुंभ मार्गांवरील घटनांना जलद प्रतिसाद द्या.',
    'home.cta.register.title': 'नवीन यात्री नोंदणी',
    'home.cta.register.desc': 'सत्यापित वैयक्तिक व वैद्यकीय माहिती सहित नोंदणी करा',
    'home.cta.search.title': 'आपत्कालीन रेकॉर्ड शोध',
    'home.cta.search.desc': 'आपत्कालात यात्रेकरूची वैद्यकीय नोंद पटकन शोधा',
    'home.designedFor.title': 'कुंभ मेळा ग्राउंड टीमसाठी',
    'home.designedFor.1': 'वैद्यकीय इतिहास व अलर्जी सहित पूर्ण प्रोफाईल नोंदवा',
    'home.designedFor.2': 'नाव, फोन, किंवा कुंभ नोंदणी क्रमांकाने तत्काळ शोध',
    'home.designedFor.3': 'जलद समन्वयासाठी आपत्कालीन संपर्क व लोकेशन माहिती',
    'home.designedFor.4': 'घाट/कॅम्प/प्रवास ठिकाणी घटना नोंद (लॉगिंग)',
    'home.designedFor.5': 'ट्रायेज व रेफरलसाठी संपूर्ण इतिहास',

    'nav.backHome': 'होमवर परत',
    'nav.home': 'होम',
    'nav.register': 'नोंदणी',
    'nav.search': 'शोध',
    'nav.analytics': 'एनालिटिक्स',
    'nav.lostFound': 'हरवले आणि सापडले',
    'nav.ariaMain': 'मुख्य नेव्हिगेशन',
    'lang.label': 'भाषा',
    'lang.en': 'EN',
    'lang.hi': 'हिंदी',
    'lang.mr': 'मराठी',
    'lang.current': ({ code }: any) => `निवडलेली: ${code}`,

    'register.pageTitle': 'नवीन यात्री नोंदणी',
    'register.pageDesc': 'नाशिक कुंभ मेळ्यासाठी यात्रेकरूची माहिती व वैद्यकीय इतिहास नोंदवा',
    'register.successTitle': 'नोंदणी यशस्वी!',
    'register.kumbhId': 'कुंभ नोंदणी ID:',
    'register.redirecting': 'थोड्याच वेळात होमवर जात आहोत...',

    'reg.personalInfo': 'वैयक्तिक माहिती',
    'reg.fullName': 'पूर्ण नाव *',
    'reg.age': 'वय *',
    'reg.gender': 'लिंग *',
    'reg.gender.male': 'पुरुष',
    'reg.gender.female': 'स्त्री',
    'reg.gender.other': 'इतर',
    'reg.phone': 'फोन नंबर *',

    'reg.emergencyName': 'आपत्कालीन संपर्क नाव *',
    'reg.emergencyPhone': 'आपत्कालीन संपर्क फोन *',
    'reg.selfie': 'सेल्फी फोटो *',
    'reg.takeSelfie': 'सेल्फी घ्या',
    'reg.selfieHint': 'कृपया एकटे रहा आणि फोटो घेताना तोंड बंद ठेवा.',
    'reg.medicalInfo': 'वैद्यकीय माहिती',
    'reg.bloodGroup': 'ब्लड ग्रुप',
    'reg.selectBloodGroup': 'ब्लड ग्रुप निवडा',
    'reg.height': 'उंची (cm)',
    'reg.weight': 'वजन (kg)',

    'reg.allergies': 'अलर्जी',
    'reg.allergiesPlaceholder': 'अन्न/औषधांची अलर्जी इ.',
    'reg.chronic': 'दीर्घकालीन आजार',
    'reg.chronicPlaceholder': 'निवडा...',
    'condition.diabetes': 'मधुमेह (Diabetes)',
    'condition.hypertension': 'उच्च रक्तदाब (BP)',
    'condition.asthma': 'दमा (Asthma)',
    'condition.arthritis': 'सांधेदुखी (Arthritis)',
    'condition.none': 'काही नाही',
    'condition.other': 'इतर (नमूद करा)',
    'reg.meds': 'सध्याची औषधे',
    'reg.medsPlaceholder': 'औषधे व डोस लिहा',
    'reg.surgeries': 'पूर्वीची शस्त्रक्रिया',
    'reg.surgeriesPlaceholder': 'पूर्वीच्या शस्त्रक्रिया लिहा',
    'reg.notes': 'विशेष वैद्यकीय नोंदी',
    'reg.notesPlaceholder': 'इतर महत्त्वाची वैद्यकीय माहिती',
    'reg.submitting': 'नोंदणी सुरू आहे...',
    'reg.submit': 'यात्री नोंदणी करा',
    'reg.fail': ({ message }: any) => `नोंदणी अयशस्वी: ${message}`,
    'reg.reviewTitle': 'तुमची माहिती तपासा',
    'reg.reviewDesc': 'कृपया सबमिट करण्यापूर्वी सर्व माहिती तपासा',
    'reg.editInfo': 'परत जा आणि संपादित करा',
    'reg.confirmSubmit': 'नोंदणी सबमिट करा',
    'reg.reviewSubmit': 'पुनरावलोकनासाठी सुरू ठेवा',



    'search.pageTitle': 'यात्री वैद्यकीय नोंदी शोधा',
    'search.pageDesc': 'आपत्कालात यात्रेकरूची माहिती पटकन शोधा',
    'search.type.name': 'नाव',
    'search.type.phone': 'फोन',
    'search.type.registration': 'नोंदणी क्र.',
    'search.placeholder': ({ type }: any) => `${type} ने शोधा...`,
    'search.searching': 'शोधत आहोत...',
    'search.search': 'शोधा',
    'search.byFace': 'चेहऱ्याने शोधा (सेल्फी)',
    'search.orSeparator': 'किंवा तपशीलाने शोधा',
    'search.noneFound': 'तुमच्या शोधाशी जुळणारे रेकॉर्ड मिळाले नाहीत.',
    'search.found': ({ count }: any) => `${count} परिणाम मिळाले`,
    'search.age': 'वय:',
    'search.gender': 'लिंग:',
    'search.phone': 'फोन:',
    'search.blood': 'ब्लड:',

    'search.match': ({ pct }: any) => `जुळणं: ${pct}%`,
    'search.fail': ({ message }: any) => `शोध अयशस्वी: ${message}`,
    'search.face.noDescriptor': 'फोटोमधून चेहरा वाचता आला नाही. कृपया चांगल्या प्रकाशात पुन्हा प्रयत्न करा.',
    'search.face.fail': ({ message }: any) => `चेहरा शोध अयशस्वी: ${message}`,
    'search.filter.gender': 'लिंगानुसार फिल्टर',
    'search.filter.gender.all': 'सर्व',
    'search.filter.gender.male': 'पुरुष',
    'search.filter.gender.female': 'स्त्री',
    'search.filter.gender.other': 'इतर',
    'search.filter.minAge': 'किमान वय',
    'search.filter.maxAge': 'कमाल वय',
    'search.filter.noneAfterFilter': 'फिल्टर नंतर कोणताही रिझल्ट राहिला नाही. कृपया फिल्टर बदला.',
    'search.quickIncident': 'या यात्रेकरूसाठी घटना नोंदवा',
    'search.chronic': 'दीर्घकालीन आजार:',

    'profile.registration': 'नोंदणी:',
    'profile.emergencyContact': 'आपत्कालीन संपर्क',
    'profile.name': 'नाव:',
    'profile.personalDetails': 'वैयक्तिक तपशील',
    'profile.ageYears': ({ years }: any) => `${years} वर्षे`,
    'profile.gender': 'लिंग:',
    'profile.phone': 'फोन:',

    'profile.vitalInfo': 'महत्त्वाची माहिती',
    'profile.bloodGroup': 'ब्लड ग्रुप:',
    'profile.height': 'उंची:',
    'profile.weight': 'वजन:',
    'profile.notSpecified': 'नमूद नाही',

    'profile.medicalHistory': 'वैद्यकीय इतिहास',
    'profile.allergies': 'अलर्जी:',
    'profile.noneReported': 'काही नाही',
    'profile.chronic': 'दीर्घकालीन आजार:',
    'profile.none': 'काही नाही',
    'profile.meds': 'सध्याची औषधे:',
    'profile.surgeries': 'पूर्वीची शस्त्रक्रिया:',
    'profile.specialNotes': 'विशेष नोंदी:',
    'profile.incidentsHistory': 'वैद्यकीय घटनांचा इतिहास',
    'profile.recordIncident': 'नवीन घटना नोंदवा',
    'profile.loadingIncidents': 'घटना लोड होत आहेत...',
    'profile.noIncidents': 'कोणतीही वैद्यकीय घटना नोंदलेली नाही.',
    'profile.followUpRequired': 'फॉलो-अप आवश्यक',
    'profile.symptoms': 'लक्षणे:',
    'profile.diagnosis': 'निदान:',
    'profile.treatment': 'उपचार:',
    'profile.medications': 'औषधे:',
    'profile.doctor': 'डॉक्टर:',
    'profile.center': 'केंद्र:',
    'profile.followUpNotes': 'फॉलो-अप नोंदी:',

    'incident.title': 'वैद्यकीय घटना नोंदवा',
    'incident.for': 'यांच्यासाठी:',
    'incident.type': 'घटना प्रकार *',
    'incident.type.emergency': 'आपत्काल',
    'incident.type.consultation': 'तपासणी/सल्ला',
    'incident.type.followup': 'फॉलो-अप',
    'incident.doctor': 'ड्युटी डॉक्टर *',
    'incident.doctorPlaceholder': 'डॉ. नाव',
    'incident.center': 'मेडिकल सेंटर *',
    'incident.centerPlaceholder': 'केंद्र/रुग्णालय नाव',
    'incident.symptoms': 'लक्षणे *',
    'incident.symptomsPlaceholder': 'लक्षणे लिहा...',
    'incident.diagnosis': 'निदान',
    'incident.diagnosisPlaceholder': 'निदान लिहा...',
    'incident.treatment': 'दिला गेलेला उपचार',
    'incident.treatmentPlaceholder': 'उपचार लिहा...',
    'incident.meds': 'दिलेली औषधे',
    'incident.medsPlaceholder': 'औषधे व डोस लिहा...',
    'incident.followUpRequired': 'फॉलो-अप आवश्यक',
    'incident.followUpHelp': 'रुग्णाला फॉलो-अप लागल्यास निवडा',
    'incident.followUpNotes': 'फॉलो-अप नोंदी',
    'incident.followUpNotesPlaceholder': 'फॉलो-अप सूचना...',
    'incident.cancel': 'रद्द करा',
    'incident.saving': 'सेव होत आहे...',
    'incident.submit': 'घटना नोंदवा',
    'incident.fail': ({ message }: any) => `घटना नोंदली गेली नाही: ${message}`,

    // Lost & Found - Marathi
    'lost.title': 'AI हरवले-सापडले (Lost & Found)',
    'lost.subtitle': 'चेहरा ओळखीद्वारे कुटुंबांना पुन्हा एकत्र करणे',
    'lost.backHome': 'होमवर परत',
    'lost.reportMissing': 'हरवलेल्या व्यक्तीची तक्रार करा',
    'lost.reportMissingDesc': 'हरवलेल्या नातेवाईकाचा फोटो आणि माहिती अपलोड करा',
    'lost.foundSomeone': 'मला कोणीतरी सापडले',
    'lost.foundSomeoneDesc': 'ते हरवले आहेत का हे तपासण्यासाठी चेहरा स्कॅन करा',
    'lost.recent': 'अलीकडे हरवलेल्यांच्या तक्रारी',
    'lost.noActive': 'कोणतीही सक्रिय तक्रार नाही.',
    'lost.badge.missing': 'हरवले',
    'lost.reportDetails': 'तक्रार तपशील',
    'lost.form.name': 'पूर्ण नाव',
    'lost.form.age': 'वय (अंदाजे)',
    'lost.form.gender': 'लिंग',
    'lost.form.contact': 'तुमचे संपर्क नाव/फोन',
    'lost.form.contactPlaceholder': 'उदा. राहुल - 9876543210',
    'lost.submit': 'तक्रार सबमिट करा',
    'lost.submitting': 'सबमिट होत आहे...',
    'lost.match.title': 'मॅच निकाल',
    'lost.match.none': 'कोणतीही मॅच सापडली नाही',
    'lost.match.noneDesc': 'या व्यक्तीबद्दल अद्याप कोणतीही तक्रार आलेली नाही.',
    'lost.match.reportAsFound': 'त्याऐवजी "सापडले" म्हणून नोंदवा',
    'lost.match.foundCount': ({ count }: any) => `${count} संभाव्य मॅच सापडल्या!`,
    'lost.match.matchPct': ({ pct }: any) => `${pct}% मॅच`,
    'lost.match.reportedBy': 'तक्रारदार:',
    'lost.match.missingSince': 'कधीपासून हरवले:',
    'lost.match.call': 'कॉल करा',

    // Analytics Alerts
    'analytics.alert.title': 'सरकारी वैद्यकीय इशारा!',
    'analytics.alert.desc': ({ condition, count }: any) => `उच्च जोखीम गट: ${condition} च्या ${count} केसेस. त्वरित लक्ष द्या.`,



    'common.close': 'बंद करा',
    'common.add': 'जोडा',
    'common.voiceNotSupported': 'या ब्राउझरमध्ये व्हॉइस इनपुट समर्थित नाही.',
    'common.voiceMicDenied': 'मायक्रोफोन परवानगी नाकारली. कृपया तुमच्या ब्राउझर सेटिंग्जमध्ये मायक्रोफोन परवानगी द्या.',
    'common.voiceNoMic': 'मायक्रोफोन आढळला नाही. कृपया मायक्रोफोन कनेक्ट केलेला आहे याची खात्री करा.',
    'common.voiceNetworkError': 'नेटवर्क त्रुटी आली. कृपया तुमचे इंटरनेट कनेक्शन तपासा आणि पुन्हा प्रयत्न करा.',
    'common.total': 'एकूण',
    'common.copied': 'कॉपी केले!',
    'common.copy': 'कॉपी',
    'common.startVoice': 'व्हॉइस इनपुट सुरू करा',
    'common.stopVoice': 'ऐकणे थांबवा',
    'common.listening': 'ऐकत आहे...',

    'selfie.loadingModels': 'फेस मॉडेल्स लोड होत आहेत...',
    'selfie.failModels': 'फेस मॉडेल्स लोड झाले नाहीत. इंटरनेट तपासा आणि पेज रिफ्रेश करा.',
    'selfie.failCamera': 'कॅमेरा उघडता आला नाही. कृपया कॅमेरा परवानगी द्या.',
    'selfie.failCameraShort': 'कॅमेरा उघडता आला नाही.',
    'selfie.title': 'सेल्फी घ्या',
    'selfie.retake': 'परत घ्या',
    'selfie.usePhoto': 'ही फोटो वापरा',
    'selfie.cancel': 'रद्द करा',
    'selfie.capturing': 'कॅप्चर होत आहे...',
    'selfie.capture': 'फोटो घ्या',
    'selfie.tip.1': 'फ्रेममध्ये एकटे रहा',
    'selfie.tip.2': 'तोंड बंद ठेवा',
    'selfie.tip.3': 'कॅमेऱ्याकडे बघा',
    'selfie.tip.4': 'चांगला प्रकाश ठेवा',
    'selfie.noFace': 'चेहरा आढळला नाही. कृपया कॅमेऱ्यासमोर या.',
    'selfie.multiFace': 'एकाहून अधिक चेहरे आढळले. कृपया एकटे रहा.',
    'selfie.landmarksOk': 'चेहरा आढळला. फोटो घेऊ शकता.',
    'selfie.ready': '✓ चेहरा आढळला. फोटो घ्या!',
    'selfie.bodyTip': 'अचूक उंची/वजन शोधण्यासाठी',
    'selfie.bodyInstructions': 'तुमचे संपूर्ण शरीर डोक्यापासून पायापर्यंत दाखवण्यासाठी मागे जा',
    'selfie.bodyDetected': 'शरीर ओळखले! फोटो घेण्यासाठी तयार',
    'selfie.bodyNotVisible': 'कृपया आपल्या शरीराचा अधिक भाग दाखवा',
    'selfie.mouthOpen': 'कृपया तोंड बंद ठेवा.',
  },
};

export function I18nProvider({ children }: { children: React.ReactNode }) {
  const [lang, setLangState] = useState<Language>('en');

  useEffect(() => {
    const stored = window.localStorage.getItem(STORAGE_KEY) as Language | null;
    if (stored === 'en' || stored === 'hi' || stored === 'mr') {
      setLangState(stored);
    }
  }, []);

  const setLang = (next: Language) => {
    setLangState(next);
    window.localStorage.setItem(STORAGE_KEY, next);
  };

  const t = useMemo(() => {
    return (key: string, vars?: Record<string, string | number>) => {
      const entry = DICT[lang][key];
      if (typeof entry === 'function') return entry(vars);
      if (typeof entry === 'string') return interpolate(entry, vars);
      // Fallback to English, then key
      const fallback = DICT.en[key];
      if (typeof fallback === 'function') return fallback(vars);
      if (typeof fallback === 'string') return interpolate(fallback, vars);
      return key;
    };
  }, [lang]);

  const value = useMemo<I18nContextValue>(() => ({ lang, setLang, t }), [lang, t]);

  return <I18nContext.Provider value={value}>{children}</I18nContext.Provider>;
}

export function useI18n() {
  const ctx = useContext(I18nContext);
  if (!ctx) throw new Error('useI18n must be used within I18nProvider');
  return ctx;
}

